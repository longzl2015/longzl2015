<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    hostname: new URL('https://longzl2015.github.io').hostname,
    root: '/',
    scheme: 'Gemini',
    version: '7.7.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    comments: {"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"我们没有找到任何搜索结果: ${query}","hits_stats":"找到约${hits}条结果（用时${time}ms）"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":true},
    path: 'search.xml',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}
  };
</script>

  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="https://longzl2015.github.io/page/27/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="zhoul">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://longzl2015.github.io/page/27/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: true,
    isPost: false
  };
</script>

  <title>Hexo</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Hexo</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签<span class="badge">190</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类<span class="badge">92</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档<span class="badge">351</span></a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="none"
           placeholder="搜索..." spellcheck="false"
           type="text" id="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://longzl2015.github.io/2018/01/04/2%E8%AF%AD%E8%A8%80/scala/apply/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="zhoul">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2018/01/04/2%E8%AF%AD%E8%A8%80/scala/apply/" class="post-title-link" itemprop="url">apply, update 语法糖</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-01-05 03:30:09" itemprop="dateCreated datePublished" datetime="2018-01-05T03:30:09+08:00">2018-01-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-02-27 17:16:07" itemprop="dateModified" datetime="2020-02-27T17:16:07+08:00">2020-02-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AF%AD%E8%A8%80/" itemprop="url" rel="index">
                    <span itemprop="name">语言</span>
                  </a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AF%AD%E8%A8%80/scala/" itemprop="url" rel="index">
                    <span itemprop="name">scala</span>
                  </a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2018/01/04/2%E8%AF%AD%E8%A8%80/scala/apply/#comments" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2018/01/04/2语言/scala/apply/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="apply-update-语法糖"><a href="#apply-update-语法糖" class="headerlink" title="apply, update 语法糖"></a>apply, update 语法糖</h1><p>[TOC]</p>
<p>语法糖，又称为糖衣语法，指计算机语言中添加的某种语法，这种语法对语言的功能并没有影响，但是更方便程序员使用。通常来说可以增加程序的可读性，从而减少程度代码出错的机会。接下来就会介绍两个 Scala 中的语法糖。</p>
<h2 id="apply"><a href="#apply" class="headerlink" title="apply"></a>apply</h2><p>在 Scala 中，如果我们要频繁调用某个 class 或 object 的方法，我们可以通过定义 apply 方法来避免每次写出该函数的调用，而使用一种更加简洁的方式，来看下面的例子：</p>
<p><strong>不使用 apply 方法</strong></p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">scala&gt; <span class="class"><span class="keyword">class</span> <span class="title">truck</span> </span>&#123;</span><br><span class="line">     |   <span class="function"><span class="keyword">def</span> <span class="title">transport</span></span>( goods: <span class="type">Int</span> ): <span class="type">Unit</span> = &#123;</span><br><span class="line">     |     println( <span class="string">"truck transport "</span> + goods + <span class="string">"t goods"</span> )</span><br><span class="line">     |   &#125;</span><br><span class="line">     | &#125;</span><br><span class="line">defined <span class="class"><span class="keyword">class</span> <span class="title">truck</span></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">scala&gt;</span>     <span class="title">val</span> <span class="title">t</span> </span>= <span class="keyword">new</span> truck</span><br><span class="line">t: truck = truck@<span class="number">77468</span>bd9</span><br><span class="line"></span><br><span class="line">scala&gt;     t.transport( <span class="number">100</span> )</span><br><span class="line">truck transport <span class="number">100</span>t goods</span><br></pre></td></tr></table></figure>

<p><strong>使用 apply 方法</strong></p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">scala&gt; <span class="class"><span class="keyword">class</span> <span class="title">truck</span> </span>&#123;</span><br><span class="line">     |   <span class="function"><span class="keyword">def</span> <span class="title">apply</span></span>( goods: <span class="type">Int</span> ): <span class="type">Unit</span> = &#123;</span><br><span class="line">     |     println( <span class="string">"truck transport "</span> + goods + <span class="string">"t goods"</span> )</span><br><span class="line">     |   &#125;</span><br><span class="line">     | &#125;</span><br><span class="line">defined <span class="class"><span class="keyword">class</span> <span class="title">truck</span></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">scala&gt;</span></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">scala&gt;</span> <span class="title">val</span> <span class="title">t</span> </span>= <span class="keyword">new</span> truck</span><br><span class="line">t: truck = truck@<span class="number">68</span>bbe345</span><br><span class="line"></span><br><span class="line">scala&gt; t(<span class="number">100</span>)</span><br><span class="line">truck transport <span class="number">100</span>t goods</span><br></pre></td></tr></table></figure>

<p>上面两个例子的效果是完全一样的，下面这个定义了 apply 的类能让我们在频繁调用某个方法的时候更加方便。当然，apply 方法支持任意类型和任意个参数。</p>
<p>另一种 apply 常用的使用场景是用 object 来创建其伴生类的实例。如下例：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">truck</span> </span>&#123;</span><br><span class="line">  println( <span class="string">"new truck created!"</span> )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">truck</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">apply</span></span>(): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="keyword">new</span> truck</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">TT</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span> </span>(args: <span class="type">Array</span>[<span class="type">String</span>]) &#123;</span><br><span class="line">    <span class="keyword">val</span> t = truck()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> truck created!</span><br></pre></td></tr></table></figure>

<p>其实上例中，<code>truck()</code>就是调用了<code>truck.apply()</code>方法，编译器在编译时将<code>truck()</code>编译成<code>truck.apply()</code>，如果你对编译后的结果进行反编译就能验证这一点，这留给有兴趣的同学自行实践，这里不展开了。</p>
<p>apply 方法在我们平时写代码时也经常碰到，比如：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> l = <span class="type">List</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>)</span><br></pre></td></tr></table></figure>

<p>中的 <code>List(1,2,3)</code> 调用就是调用的 object List 的 apply 方法</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">List</span> <span class="keyword">extends</span> <span class="title">scala</span>.<span class="title">collection</span>.<span class="title">generic</span>.<span class="title">SeqFactory</span>[scala.collection.immutable.<span class="type">List</span>] <span class="keyword">with</span> <span class="title">scala</span>.<span class="title">Serializable</span> </span>&#123;</span><br><span class="line">  <span class="keyword">implicit</span> <span class="function"><span class="keyword">def</span> <span class="title">canBuildFrom</span></span>[<span class="type">A</span>] : scala.collection.generic.<span class="type">CanBuildFrom</span>[<span class="type">List</span>.<span class="type">Coll</span>, <span class="type">A</span>, scala.collection.immutable.<span class="type">List</span>[<span class="type">A</span>]] = &#123; <span class="comment">/* compiled code */</span> &#125;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">newBuilder</span></span>[<span class="type">A</span>] : scala.collection.mutable.<span class="type">Builder</span>[<span class="type">A</span>, scala.collection.immutable.<span class="type">List</span>[<span class="type">A</span>]] = &#123; <span class="comment">/* compiled code */</span> &#125;</span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">empty</span></span>[<span class="type">A</span>] : scala.collection.immutable.<span class="type">List</span>[<span class="type">A</span>] = &#123; <span class="comment">/* compiled code */</span> &#125;</span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">apply</span></span>[<span class="type">A</span>](xs : <span class="type">A</span>*) : scala.collection.immutable.<span class="type">List</span>[<span class="type">A</span>] = &#123; <span class="comment">/* compiled code */</span> &#125;</span><br><span class="line">  <span class="keyword">private</span>[collection] <span class="keyword">val</span> partialNotApplied : scala.<span class="type">AnyRef</span> <span class="keyword">with</span> scala.<span class="type">Function1</span>[scala.<span class="type">Any</span>, scala.<span class="type">Any</span>] = &#123; <span class="comment">/* compiled code */</span> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="update"><a href="#update" class="headerlink" title="update"></a>update</h2><p>除了 apply 方法，还有一个用于赋值时的 update 方法，</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">scala&gt; <span class="keyword">val</span> a = mutable.<span class="type">Map</span>[ <span class="type">Int</span>, <span class="type">Int</span> ]()</span><br><span class="line">a: scala.collection.mutable.<span class="type">Map</span>[<span class="type">Int</span>,<span class="type">Int</span>] = <span class="type">Map</span>()</span><br><span class="line"></span><br><span class="line">scala&gt; a(<span class="number">1</span>) = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">scala&gt; println( a )</span><br><span class="line"><span class="type">Map</span>(<span class="number">1</span> -&gt; <span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<p>当我们调用 <code>a(1) = 1</code> 的时候其实是在调用 <code>a.update(1,1)</code>，当然你也可以在自定义类中实现 update 使调用更方便。就像下面这个例子一样</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">scala&gt; <span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">     |   <span class="keyword">private</span> <span class="keyword">var</span> a = <span class="number">0</span></span><br><span class="line">     |</span><br><span class="line">     |   <span class="function"><span class="keyword">def</span> <span class="title">update</span></span>( i: <span class="type">Int</span> ): <span class="type">Unit</span> = &#123;</span><br><span class="line">     |     a = i</span><br><span class="line">     |     println( a )</span><br><span class="line">     |   &#125;</span><br><span class="line">     | &#125;</span><br><span class="line">defined <span class="class"><span class="keyword">class</span> <span class="title">A</span></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">scala&gt;</span> <span class="title">val</span> <span class="title">a</span> </span>= <span class="keyword">new</span> <span class="type">A</span></span><br><span class="line">a: <span class="type">A</span> = <span class="type">A</span>@<span class="number">27e47833</span></span><br><span class="line"></span><br><span class="line">scala&gt; a() = <span class="number">2</span></span><br><span class="line"><span class="number">2</span></span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://longzl2015.github.io/2018/01/04/2%E8%AF%AD%E8%A8%80/scala/case%20class/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="zhoul">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2018/01/04/2%E8%AF%AD%E8%A8%80/scala/case%20class/" class="post-title-link" itemprop="url">case class简单介绍</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-01-05 03:30:09" itemprop="dateCreated datePublished" datetime="2018-01-05T03:30:09+08:00">2018-01-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-02-27 17:16:07" itemprop="dateModified" datetime="2020-02-27T17:16:07+08:00">2020-02-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AF%AD%E8%A8%80/" itemprop="url" rel="index">
                    <span itemprop="name">语言</span>
                  </a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AF%AD%E8%A8%80/scala/" itemprop="url" rel="index">
                    <span itemprop="name">scala</span>
                  </a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2018/01/04/2%E8%AF%AD%E8%A8%80/scala/case%20class/#comments" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2018/01/04/2语言/scala/case class/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="case-class简单介绍"><a href="#case-class简单介绍" class="headerlink" title="case class简单介绍"></a>case class简单介绍</h1><p>[TOC]</p>
<p>本文将基于下面这个简单的例子来说明 case class</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">case class Person( lastname: String, firstname: String, birthYear: Int )</span><br></pre></td></tr></table></figure>

<h2 id="你可能知道的知识"><a href="#你可能知道的知识" class="headerlink" title="你可能知道的知识"></a>你可能知道的知识</h2><p>当你声明了一个 case class，Scala 编译器为你做了这些：</p>
<ul>
<li><p>创建 case class 和它的伴生 object</p>
</li>
<li><p>实现了 apply 方法让你不需要通过 new 来创建类实例</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">scala&gt; case class Person(lastname: String, firstname: String, birthYear: Int)</span><br><span class="line">defined class Person</span><br><span class="line"></span><br><span class="line">scala&gt; val p &#x3D; Person(&quot;Lacava&quot;, &quot;Alessandro&quot;, 1976)</span><br><span class="line">p: Person &#x3D; Person(Lacava,Alessandro,1976)</span><br></pre></td></tr></table></figure>
</li>
<li><p>默认为主构造函数参数列表的所有参数前加 val</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">scala&gt; println( p.lastname )</span><br><span class="line">Lacava</span><br><span class="line"></span><br><span class="line">scala&gt; p.lastname &#x3D; &quot;jhon&quot;</span><br><span class="line">&lt;console&gt;:10: error: reassignment to val</span><br><span class="line">   p.lastname &#x3D; &quot;jhon&quot;</span><br><span class="line">              ^</span><br></pre></td></tr></table></figure>
</li>
<li><p>添加天然的 hashCode、equals 和 toString 方法。由于 == 在 Scala 中总是代表 equals，所以 case class 实例总是可比较的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">scala&gt; val p_1 &#x3D; new Person( &quot;Brown&quot;, &quot;John&quot;, 1969 )</span><br><span class="line">p_1: Person &#x3D; Person(Brown,John,1969)</span><br><span class="line"></span><br><span class="line">scala&gt;val p_2 &#x3D; new Person( &quot;Lacave&quot;, &quot;Alessandro&quot;, 1976)</span><br><span class="line">p_2: Person &#x3D; Person(Lacave,Alessandro,1976)</span><br><span class="line"></span><br><span class="line">scala&gt; p_1.hashCode</span><br><span class="line">res1: Int &#x3D; -1362628729</span><br><span class="line"></span><br><span class="line">scala&gt; p_1.toString</span><br><span class="line">res2: String &#x3D; Person(Brown,John,1969)</span><br><span class="line"></span><br><span class="line">scala&gt; p_1.equals(p_2)</span><br><span class="line">res3: Boolean &#x3D; false</span><br><span class="line"></span><br><span class="line">scala&gt; p_1 &#x3D;&#x3D; p_2</span><br><span class="line">res4: Boolean &#x3D; false</span><br></pre></td></tr></table></figure>
</li>
<li><p>生成一个 <code>copy</code> 方法以支持从实例 a 生成另一个实例 b，实例 b 可以指定构造函数参数与 a 一致或不一致</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;&lt; 保留 lastname 一致，修改 firstname 和 birthYear</span><br><span class="line">scala&gt; val p_3 &#x3D; p.copy(firstname &#x3D; &quot;Michele&quot;, birthYear &#x3D; 1972)</span><br><span class="line">p_3: Person &#x3D; Person(Lacava,Michele,1972)</span><br></pre></td></tr></table></figure>
</li>
<li><p>由于编译器实现了 unapply 方法，一个 case class 支持模式匹配</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">scala&gt; case class A( a: Int )</span><br><span class="line">defined class A</span><br><span class="line"></span><br><span class="line">scala&gt; case class B( b: String )</span><br><span class="line">defined class B</span><br><span class="line"></span><br><span class="line">scala&gt; def classMath( x: AnyRef ): Unit &#x3D; &#123;</span><br><span class="line">     |   x match &#123;</span><br><span class="line">     |     case A(a) &#x3D;&gt; println( &quot;A:&quot; + a )</span><br><span class="line">     |     case B(b) &#x3D;&gt; println( &quot;B:&quot; + b )</span><br><span class="line">     |     case A &#x3D;&gt; println( A.apply(100) )</span><br><span class="line">     |   &#125;</span><br><span class="line">     | &#125;</span><br><span class="line">classMath: (x: AnyRef)Unit</span><br><span class="line"></span><br><span class="line">scala&gt; val a &#x3D; A( 1 )</span><br><span class="line">a: A &#x3D; A(1)</span><br><span class="line"></span><br><span class="line">scala&gt; val b &#x3D; B( &quot;b&quot; )</span><br><span class="line">b: B &#x3D; B(b)</span><br><span class="line"></span><br><span class="line">scala&gt; classMath( a )</span><br><span class="line">A:1</span><br><span class="line"></span><br><span class="line">scala&gt; classMath( b )</span><br><span class="line">B:b</span><br></pre></td></tr></table></figure>

<p>也许你已经知道，在模式匹配中，当你的 case class 没有参数的时候，你是在使用 case object 而不是一个空参数列表的 case class</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">scala&gt; classMath( A )</span><br><span class="line">A(100)</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>除了在模式匹配中使用之外，<code>unapply</code> 方法可以让你结构 case class 来提取它的字段，如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">scala&gt; val Person(lastname, _, _) &#x3D; p</span><br><span class="line">lastname: String &#x3D; Lacava</span><br></pre></td></tr></table></figure>

<h2 id="你可能不知道的知识"><a href="#你可能不知道的知识" class="headerlink" title="你可能不知道的知识"></a>你可能不知道的知识</h2><ul>
<li><p>获取一个函数接收一个 tuple 作为参数，该 tuple 的元素类型与个数与某 case class 相同，那么可以将该 tuple 作为 case class 的 tuple 方法参数来构造 case class 实例</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">scala&gt; val meAsTuple: (String, String, Int) &#x3D; (&quot;Lacava&quot;, &quot;Alessandro&quot;, 1976)</span><br><span class="line">meAsTuple: (String, String, Int) &#x3D; (Lacava,Alessandro,1976)</span><br><span class="line"></span><br><span class="line">scala&gt; Person.tupled( meAsTuple )</span><br><span class="line">res2: Person &#x3D; Person(Lacava,Alessandro,1976)</span><br></pre></td></tr></table></figure>
</li>
<li><p>相对用 tuple 来创建 case class 实例，还可以从 case class 实例中解构并提取出 tuple 对象</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">scala&gt; val transform: Person &#x3D;&gt; Option[ (String, String, Int) ] &#x3D; &#123;</span><br><span class="line"> |   Person.unapply _</span><br><span class="line"> | &#125;</span><br><span class="line">transform: Person &#x3D;&gt; Option[(String, String, Int)] &#x3D; &lt;function1&gt;</span><br><span class="line"></span><br><span class="line">scala&gt; transform( p )</span><br><span class="line">res0: Option[(String, String, Int)] &#x3D; Some((Lacava,Alessandro,1976))</span><br></pre></td></tr></table></figure>

<hr>
</li>
</ul>
<h2 id="另一种定义-case-class-的方式"><a href="#另一种定义-case-class-的方式" class="headerlink" title="另一种定义 case class 的方式"></a>另一种定义 case class 的方式</h2><p>  还有另一种很少人知道的定义 case class 的方式，如：</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">case class Person( lastname: String )( firstname: String, birthYear: Int )</span><br></pre></td></tr></table></figure>

<p>  这种方式有点像偏函数，有两个参数列表，要注意的是，对这两个参数列表是区别对待的。上文提到的所有 case class 的特性在这种定义方式下只作用于第一个参数列表中的参数（比如在参数前自动加 val，模式匹配，copy 支持等等），第二个及之后的参数列表中的参数和普通的 class 参数列表参数无异。</p>
<p>  <strong>firstname和birthYear前不再自动添加 val，不再是类的成员</strong></p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">scala&gt; val p &#x3D; Person(&quot;Lacava&quot;)(&quot;Alessandro&quot;, 1976)</span><br><span class="line">p: Person &#x3D; Person(Lacava)</span><br><span class="line"></span><br><span class="line">scala&gt; p.lastname</span><br><span class="line">res0: String &#x3D; Lacava</span><br><span class="line"></span><br><span class="line">scala&gt; p.firstname</span><br><span class="line">&lt;console&gt;:11: error: value firstname is not a member of Person</span><br><span class="line">              p.firstname</span><br><span class="line">                ^</span><br><span class="line"></span><br><span class="line">scala&gt; p.birthYear</span><br><span class="line">&lt;console&gt;:11: error: value birthYear is not a member of Person</span><br><span class="line">              p.birthYear</span><br><span class="line">                ^</span><br></pre></td></tr></table></figure>

<p>  <strong>copy 时，当不指定birthYear的值时，不会使用 p 中的birthYear，因为根本没这个值，会报错</strong></p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">scala&gt; p.copy()(firstname &#x3D; &quot;Jhon&quot;)</span><br><span class="line">&lt;console&gt;:11: error: not enough arguments for method copy: (firstname: String, birthYear: Int)Person.</span><br><span class="line">Unspecified value parameter birthYear.</span><br><span class="line">              p.copy()(firstname &#x3D; &quot;Jhon&quot;)</span><br></pre></td></tr></table></figure>

<p>  equals 和 toString 方法也发生了改变：</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">scala&gt; val p_1 &#x3D; Person(&quot;Lacava&quot;)(&quot;Jhon&quot;, 2001)</span><br><span class="line">p_1: Person &#x3D; Person(Lacava)</span><br><span class="line"></span><br><span class="line">scala&gt; p.equals(p_1)</span><br><span class="line">res9: Boolean &#x3D; true</span><br><span class="line"></span><br><span class="line">scala&gt; p &#x3D;&#x3D; p_1</span><br><span class="line">res10: Boolean &#x3D; true</span><br><span class="line"></span><br><span class="line">scala&gt; println ( p.toString )</span><br><span class="line">Person(Lacava)</span><br></pre></td></tr></table></figure>

<p>其他特性不再一一列举..</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://longzl2015.github.io/2018/01/04/2%E8%AF%AD%E8%A8%80/scala/flatMap/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="zhoul">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2018/01/04/2%E8%AF%AD%E8%A8%80/scala/flatMap/" class="post-title-link" itemprop="url">flatMap</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-01-05 03:30:09" itemprop="dateCreated datePublished" datetime="2018-01-05T03:30:09+08:00">2018-01-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-02-27 17:16:07" itemprop="dateModified" datetime="2020-02-27T17:16:07+08:00">2020-02-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AF%AD%E8%A8%80/" itemprop="url" rel="index">
                    <span itemprop="name">语言</span>
                  </a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AF%AD%E8%A8%80/scala/" itemprop="url" rel="index">
                    <span itemprop="name">scala</span>
                  </a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2018/01/04/2%E8%AF%AD%E8%A8%80/scala/flatMap/#comments" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2018/01/04/2语言/scala/flatMap/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="flatMap"><a href="#flatMap" class="headerlink" title="flatMap"></a>flatMap</h1><p>假设有个序列, 里面装了一堆人</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> xs = <span class="type">Seq</span>(john, mary, alice, bob)</span><br></pre></td></tr></table></figure>

<p>每个人有一个朋友列表, 可以这么访问:</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">x.friends <span class="comment">// 返回一个序列, 里面每个元素是一个人</span></span><br></pre></td></tr></table></figure>

<p>比如 john.friends 可能返回 Seq(harry, hermione, ron)</p>
<p>用 map 的话, 可以把 xs 里的每一个元素都变成朋友列表:</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">xs.map(x =&gt; x.friends) </span><br><span class="line"><span class="comment">// 得到一个序列的序列:</span></span><br><span class="line"><span class="comment">// Seq(</span></span><br><span class="line"><span class="comment">//   Seq(harry, hermione, ron),</span></span><br><span class="line"><span class="comment">//   Seq(sam, frodo),</span></span><br><span class="line"><span class="comment">//   Seq(),</span></span><br><span class="line"><span class="comment">//   Seq(jamie, tyrion, cersei)</span></span><br><span class="line"><span class="comment">// )</span></span><br></pre></td></tr></table></figure>

<p>然而有些时候, 你并不希望得到这么一个需要访问两层才能拿到朋友对象的序列. 有时, 你希望得到的是一个在第一层就能访问到朋友的序列. 这就需要 flatMap:</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">xs.flatMap(x =&gt; x.friends)</span><br><span class="line"><span class="comment">// 得到一个序列</span></span><br><span class="line"><span class="comment">// Seq(harry, hermione, ron, sam, frodo, jamie, tyrion, cersei)</span></span><br></pre></td></tr></table></figure>

<p>这个过程就像是先 map, 然后再将 map 出来的这些列表首尾相接 (flatten).</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://longzl2015.github.io/2018/01/04/2%E8%AF%AD%E8%A8%80/scala/scala%E8%AF%AD%E6%B3%95%E6%80%BB%E8%A7%88/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="zhoul">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2018/01/04/2%E8%AF%AD%E8%A8%80/scala/scala%E8%AF%AD%E6%B3%95%E6%80%BB%E8%A7%88/" class="post-title-link" itemprop="url">scala语法总览</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-01-05 03:30:09" itemprop="dateCreated datePublished" datetime="2018-01-05T03:30:09+08:00">2018-01-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-02-27 17:16:07" itemprop="dateModified" datetime="2020-02-27T17:16:07+08:00">2020-02-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AF%AD%E8%A8%80/" itemprop="url" rel="index">
                    <span itemprop="name">语言</span>
                  </a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AF%AD%E8%A8%80/scala/" itemprop="url" rel="index">
                    <span itemprop="name">scala</span>
                  </a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2018/01/04/2%E8%AF%AD%E8%A8%80/scala/scala%E8%AF%AD%E6%B3%95%E6%80%BB%E8%A7%88/#comments" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2018/01/04/2语言/scala/scala语法总览/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Scala"><a href="#Scala" class="headerlink" title="Scala"></a>Scala</h1><p>[TOC]</p>
<h2 id="简单介绍"><a href="#简单介绍" class="headerlink" title="简单介绍"></a>简单介绍</h2><p>Scala语言是一种面向对象语言，结合了命令式（imperative）和函数式（functional）编程风格，其设计理念是创造一种更好地支持组件的语言。</p>
<blockquote>
<p><strong>Object-Oriented Meets Functional</strong></p>
</blockquote>
<p><strong>特性</strong></p>
<ul>
<li>多范式（Multi-Paradigm）编程语言，类似Java、C#；</li>
<li>继承面向对象编程和函数式编程的特性；<ul>
<li>　　面向对象：[1]. 子类继承，[2]. 混入(<strong>Mixin</strong>)机制；</li>
<li>　　<strong>函数式</strong>：支持高阶函数、嵌套函数，模式匹配，支持柯里化(<strong>Currying</strong>)；</li>
<li>　　<strong>类型推断</strong>（Type Inference）：根据函数体中的具体内容推断方法的返回值类型</li>
</ul>
</li>
<li>更高层的并发模型，可伸缩；</li>
<li>静态类型，编译时检查；</li>
<li>允许与Java互操作（将来会支持与.Net互操作）；</li>
</ul>
<p><strong>与Java对比</strong></p>
<ul>
<li>如果用作服务器端开发，Scala的简洁、灵活性是Java无法比拟的；</li>
<li>如果是企业级应用开发、Web开发，Java的强大是Scala无法匹敌的；</li>
</ul>
<p><strong>Scala和Groovy</strong></p>
<p>Groovy的优势在于易用性以及与Java无缝衔接，更注重实效思想，脚本化；</p>
<p>Scala的优势在于性能和一些高级特性，静态类型，更具有学术思想；</p>
<p><strong>关于Lift</strong></p>
<p>一个使用了Scala的开源的Web应用框架，可以使用所有的Java库和Web容器。其他框架：Play、Bowler等。</p>
<p>##基础语法问题</p>
<p>Scala程序的执行入口是提供main方法的独立单例对象。每个Scala函数都有返回值，每个Scala表达式都有返回结果。</p>
<p>在Scala中没有静态的概念，所有东西都是面向对象的。其实object单例对象只是对静态的一种封装而已，在.class文件层面，object单例对象就是用静态（static）来实现的。</p>
<p>###一切皆为对象</p>
<p>Scala中所有的操作符都是方法，操作符面向的使用者都是对象</p>
<p>Scala编程的一个基本原则上，能不用var，尽量不用var，能不用mutable变量，尽量不用mutable变量，能避免函数的副作用，尽量不产生副作用。</p>
<blockquote>
<ul>
<li>对于任何对象，如果在其后面使用()，将调用该对象的apply方法，arr(0) == arr.apply(0)</li>
<li>如果对某个使用()的对象赋值，将该对象的update方法，arr(0)=value == arr.update(0,value)</li>
</ul>
</blockquote>
<p>###字段 + 方法 + 函数</p>
<p>scalac编译器会为类中的var字段自动添加setter和getter方法，会为类中的val方法自动添加getter方法。 其中，getter方法和字段名相同。</p>
<p>在源码中，所有对字段的显示访问，都会在class中编译成通过getter和setter方法来访问。</p>
<p>方法作用于对象，方法是对象的行为。</p>
<p>方法定义格式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">def 方法名称（参数列表）：返回值 &#x3D; &#123; 方法体 &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">val 函数名称 &#x3D; &#123; (参数列表) &#x3D;&gt; &#123; 函数体 &#125; &#125;，即 val 函数名称 &#x3D; &#123; Lambda表达式 &#125;</span><br><span class="line">或 val 函数名称 ： (入参类型 &#x3D;&gt; 出参类型) &#x3D; &#123; 入参 &#x3D;&gt; 函数体 &#125;</span><br></pre></td></tr></table></figure>

<p><strong>方法名意味着方法调用，函数名只代表函数本身</strong>。</p>
<blockquote>
<p>关于方法（Method）和函数（Function）</p>
<ul>
<li><strong>函数是一等公民</strong>，使用val语句可以定义函数，def语句定义方法；</li>
<li>函数是一个对象，继承自FuctionN，函数对象有curried,equals,isInstanceOf,toString等方法，而方法不具有；</li>
<li>函数是一个值，可以给val变量赋值，方法不是值、也不可以给val变量赋值；</li>
<li>通过将方法转化为函数的方式 method _ 或 method(_) 实现给val变量赋值；</li>
<li>若 method 有重载的情况，方法转化为函数时必须指定参数和返回值的类型；</li>
<li>某些情况下，编译器可以根据上下文自动将方法转换为函数；</li>
<li>无参数的方法 method 没有参数列表（调用：method），无参数的函数 function 有空列表（调用：function()）；</li>
<li>方法可以使用参数序列，转换为函数后，必须用 Seq 包装参数序列；</li>
<li>方法支持默认参数，函数不支持、会忽略之；</li>
</ul>
</blockquote>
<p>参考：<a href="http://www.tuicool.com/articles/yYRBnqI" target="_blank" rel="noopener">学习Scala：Scala中的字段和方法</a>； <a href="http://www.jianshu.com/p/d5ce4c683703" target="_blank" rel="noopener">Scala中Method和Function的区别 - 简书</a>；</p>
<p><strong>参数</strong></p>
<blockquote>
<ul>
<li>按名传参：By-name parameter，def fun(param: =&gt; T)。Evaluated every time it’s used within the body of the function</li>
<li>按值传参：By-value parameter。Evaluated before entry into the function/method</li>
</ul>
</blockquote>
<p>推荐将按值传参（def fun(msg: String)）改为按名称传参（def fun(msg: =&gt;String)）。这样参数会等到实际使用的时候才会计算，延迟加载计算，可以减少不必要的计算和异常。</p>
<p>###case class</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">case class PubInterfaceLog(interfaceId: Int, busiType: String, respTime: Long, publicId: Long)</span><br></pre></td></tr></table></figure>

<p>最重要的特性是支持模式匹配，Scala官方表示：</p>
<blockquote>
<p>It makes only sense to define case classes if pattern matching is used to decompose data structures.</p>
</blockquote>
<p>其他特性如下：</p>
<ul>
<li>编译器自动生成对应的伴生对象和 apply() 方法；</li>
<li>实例化时，普通类必须 new，而 case class 不需要；</li>
<li>主构造函数的参数默认是 public 级别，默认在参数为 val；</li>
<li>默认实现了 equals 和 hashCode，默认是可以序列化的，也就是实现了Serializable，toString 更优雅；</li>
<li>默认生成一个 <code>copy</code> 方法，支持从实例 a 以部分参数生成另一个实例 b；</li>
</ul>
<p>参考：<a href="http://www.jianshu.com/p/deb8ca125f6c" target="_blank" rel="noopener">Scala case class那些你不知道的知识</a>；</p>
<p>###apply() 方法</p>
<p>apply方法是Scala提供的一个语法糖</p>
<p>对apply方法的简单测试：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ApplyTest</span> </span>&#123;</span><br><span class="line">    println(<span class="string">"class ApplyTest"</span>)</span><br><span class="line">    <span class="function">def <span class="title">apply</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        println(<span class="string">"class APPLY method"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">object ApplyTest &#123;</span><br><span class="line">    println(<span class="string">"object ApplyTest"</span>)</span><br><span class="line">    <span class="function">def <span class="title">apply</span><span class="params">()</span> </span>= &#123;</span><br><span class="line">        println(<span class="string">"object APPLY method"</span>)</span><br><span class="line">        <span class="keyword">new</span> ApplyTest()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 对象名+括号，调用类的apply方法</span></span><br><span class="line">val a1 = <span class="keyword">new</span> ApplyTest()</span><br><span class="line">a1() <span class="comment">// == a1.apply()</span></span><br><span class="line"><span class="comment">// 输出 class ApplyTest, class APPLY method</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// 类名+括号，调用对象的apply方法</span></span><br><span class="line">val a2 = ApplyTest()</span><br><span class="line"><span class="comment">// 输出 object ApplyTest, object APPLY method, class ApplyTest</span></span><br><span class="line"> </span><br><span class="line">val a2 = ApplyTest()</span><br><span class="line">a2()</span><br><span class="line"><span class="comment">// 输出 object ApplyTest, object APPLY method, class ApplyTest, class APPLY method</span></span><br><span class="line"> </span><br><span class="line">val a3 = ApplyTest</span><br><span class="line"><span class="comment">// 输出 object ApplyTest</span></span><br><span class="line"> </span><br><span class="line">val a3 = ApplyTest</span><br><span class="line">a3()</span><br><span class="line"><span class="comment">// 输出 object ApplyTest, object APPLY method, class ApplyTest</span></span><br></pre></td></tr></table></figure>

<p>###几个零碎的知识点</p>
<blockquote>
<ul>
<li><strong>Array **长度不可变, 值可变；</strong>Tuple** 亦不可变，但可以包含不同类型的元素；</li>
<li><strong>List **长度不可变, 值也不可变，</strong>::: <strong>连接两个List，</strong>::** 将一个新元素放到List的最前端，空列表对象 <strong>Nil</strong></li>
<li><strong>_</strong>：通配符，类似Java中的*，<a href="http://blog.csdn.net/silentwolfyh/article/details/51174192" target="_blank" rel="noopener">下划线 “_ “ 的用法总结</a></li>
<li><strong>_=</strong>：自定义setter方法；</li>
<li><strong>_*</strong>：参数序列化，将参数序列 Range 转化为 Seq</li>
<li>i <strong>to</strong> j : [i, j]； i <strong>until</strong> j : [i, j)</li>
<li><strong>lazy **</strong>val**表示延迟初始化，无lazy var</li>
</ul>
</blockquote>
<p>###映射 + 对偶 + 元组</p>
<p>映射由对偶组成，映射是对偶的集合。<strong>对偶</strong>即键值对，键-&gt;值，（键, 值），是最简单的元组。<strong>元组</strong>是不同类型的值的聚集。</p>
<blockquote>
<p>映射是否可变表示整个映射是否可变，包括元素值、映射中元素个数、元素次序等：</p>
<ul>
<li><strong>不可变</strong>映射：直接用(scala.collection.mutable.)Map声明，维持元素插入顺序，支持 += 、-=；</li>
<li><strong>可变</strong>映射：用scala.collection.immutable.Map声明，不维持元素插入顺序，支持 +、-；</li>
</ul>
</blockquote>
<p>###构造器</p>
<blockquote>
<p>（<strong>1</strong>）<strong>主构造器</strong></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">class Student(var ID : String, var Name : String) &#123;</span><br><span class="line">    println(<span class="string">"主构造器！"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>主构造器直接跟在类名后面，主构造器的参数最后会被编译成字段</li>
<li>主构造器执行时，会执行类中所有的语句</li>
<li>如果主构造器参数声明时不加val或var，相当于声明为private级别</li>
</ul>
<p>（<strong>2</strong>）<strong>从构造器</strong></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">class Student(var ID : String, var Name : String) &#123;</span><br><span class="line">    println(<span class="string">"主构造器！"</span>)</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">var</span> Age : Int = _</span><br><span class="line">    <span class="keyword">var</span> Address : String = _</span><br><span class="line">    <span class="keyword">private</span> val Email : String = Name + ID + <span class="string">"@163.com"</span></span><br><span class="line"> </span><br><span class="line">    println(<span class="string">"从构造器！"</span>)</span><br><span class="line">    <span class="function">def <span class="title">this</span><span class="params">(ID:String, Name:String, Age:Int, Address:String)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(ID, Name)</span><br><span class="line">        <span class="keyword">this</span>.Age = Age</span><br><span class="line">        <span class="keyword">this</span>.Address = Address</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>从构造器定义在类内部，方法名为this</li>
<li>从构造器必须先调用已经存在的主或从构造器</li>
</ul>
</blockquote>
<p>###集合</p>
<p>Scala语言的一个设计目标是可以同时利用<strong>面向对象和面向函数</strong>的方法编码，因此提供的集合类分成了<strong>可以修改的集合类和不可以修改的集合类</strong>两大类型。Scala除了<strong>Array和List</strong>，还提供了<strong>Set和Map</strong>两种集合类。</p>
<blockquote>
<ul>
<li>通过 scala.collection.JavaConversions.*<em>mapAsScalaMap *</em>可将 Java 的 Map 转换为 Scala 类型的 Map；</li>
<li>通过 scala.collection.JavaConversions.*<em>mapAsJavaMap *</em>可将 Scala 的映射转换为 Java 类型的映射；</li>
<li><strong>toMap</strong> 方法将对偶集合转化为映射</li>
</ul>
</blockquote>
<p>###Option<strong>，</strong>None<strong>，</strong>Some</p>
<p><a href="http://www.jianshu.com/p/95896d06a94d" target="_blank" rel="noopener">Option<strong>，</strong>None<strong>，</strong>Some</a></p>
<blockquote>
<p>一致目标：所有皆为对象 + 函数式编程，在变量和函数返回值可能不会引用任何值的时候使用 Option 类型</p>
<ul>
<li>在没有值的时候，使用None；</li>
<li>如果有值可以引用，使用Some来包含这个值；</li>
</ul>
<p>None 和 Some 均为 Option 的子类，但是 None 被声明为一个对象，而不是一个类.</p>
</blockquote>
<p>###伴生对象</p>
<p>当单例对象（object Name，Singleton Object）与类（class Name）同名时，该单例对象称作类的伴生对象（Companion Object），该类称作单例对象的伴生类。没有伴生类的单例对象称为孤立对象（Standalone Object），最常见的就是包含程序入口main()的单例对象。</p>
<ul>
<li>同名且在同一个源文件中定义</li>
<li>可以互相访问其私有成员</li>
</ul>
<p>参考：<a href="http://lib.csdn.net/article/scala/26983" target="_blank" rel="noopener">Scala学习笔记-伴生对象于孤立对象</a>；</p>
<ul>
<li>伴生对象的属性、方法指向全局单例对象 <code>MODULE$</code></li>
<li>``伴生类的属性、方法被定义为是对象相关的</li>
</ul>
<p>单例对象在第一次访问时初始化，不可以new、不能带参数，而类可以new、可以带参数。</p>
<ul>
<li>伴生对象中定义的字段和方法， 对应同名.class类中的静态方法，对应同名$.class虚构类中的成员字段和方法</li>
<li>伴生类中定义的字段和方法， 对应同名.class类中的成员字段和成员方法</li>
</ul>
<p>同名.class类中的静态方法，会访问单例的虚构类的实例化对象， 将相关的逻辑调用转移到虚构类中的成员方法中，即：.class类提供程序的入口，$.class提供程序的逻辑调用。</p>
<ul>
<li>伴生对象中的逻辑，转移到$.class虚构类中去处理</li>
<li>伴生类中的逻辑，转移到.class同名类中的成员方法中去处理</li>
</ul>
<p>通过伴生对象来访问伴生类的实例，提供了控制实例个数的机会。虚构类的单例性，保证了伴生对象中信息的唯一性。</p>
<p>那么：伴生对象如何体现单例呢？</p>
<blockquote>
<p>因为伴生类不是单例的，如何实现单例模式呢？方法2种：</p>
<p>（<strong>1</strong>）将伴生类中的所有逻辑全部移到单例对象中，去除伴生类， 单例对象成为孤立对象， 该孤立对象天然就是单例的</p>
<p>（<strong>2</strong>）若必须存在伴生类，如何保证伴生类是单例的？ 将伴生类的主构造器私有， 并在伴生对象中创建一个伴生类的对象， 该对象就是唯一的</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> <span class="title">private</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line">object A &#123;</span><br><span class="line">  val single = <span class="keyword">new</span> A()</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// true</span></span><br><span class="line"><span class="keyword">var</span> a1 = A.single</span><br><span class="line"><span class="keyword">var</span> a2 = A.single;</span><br><span class="line">println(<span class="string">"a1 eq a2 : "</span> + (a1 eq a2))</span><br></pre></td></tr></table></figure>

<p>参考：<a href="http://www.tuicool.com/articles/N3eAVn" target="_blank" rel="noopener">学习Scala：孤立对象的实现原理</a>； <a href="http://www.tuicool.com/articles/qaq6nau" target="_blank" rel="noopener">学习Scala：伴生对象的实现原理</a>；</p>
<p>###Trait</p>
<p>特质，类似有函数体的 Interface，利用关键字 <strong>with</strong> 混入。</p>
<p>###IO读写</p>
<p>Scala本身提供 Read API，但是 Write API 需要利用Java的API，文件不存在会自动创建。</p>
<blockquote>
<p>（<strong>1</strong>）<strong>Read</strong></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> scala.io.Source</span><br><span class="line">val content = Source.fromURL(url).getLines()    <span class="comment">// 网络资源</span></span><br><span class="line">val lines = Source.fromFile(filePath).getLines()  <span class="comment">// 文件</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>（<strong>2</strong>）<strong>Write</strong></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.File</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter</span><br><span class="line"><span class="keyword">import</span> java.io.FileWriter</span><br><span class="line"><span class="keyword">import</span> java.io.BufferedWriter</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 文件首次写入，ok; 不支持追加</span></span><br><span class="line">val writer = <span class="keyword">new</span> PrintWriter(<span class="keyword">new</span> File(<span class="string">"sqh.txt"</span>))</span><br><span class="line">writer.println(<span class="string">"xxx"</span>)</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 支持追加；但是有换行问题</span></span><br><span class="line">val writer = <span class="keyword">new</span> FileWriter(<span class="keyword">new</span> File(<span class="string">"sqh.txt"</span>), <span class="keyword">true</span>)</span><br><span class="line">writer.write(<span class="string">"xxx"</span>)</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 支持追加，换行解决方法1</span></span><br><span class="line">val writer = <span class="keyword">new</span> BufferedWriter(<span class="keyword">new</span> FileWriter(<span class="keyword">new</span> File(<span class="string">"sqh.txt"</span>), <span class="keyword">true</span>))</span><br><span class="line">writer.write(<span class="string">"xxx"</span>)</span><br><span class="line">writer.newLine()</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 支持追加，换行解决方法2</span></span><br><span class="line">val writer = <span class="keyword">new</span> PrintWriter(<span class="keyword">new</span> FileWriter(<span class="keyword">new</span> File(<span class="string">"sqh.txt"</span>), <span class="keyword">true</span>))</span><br><span class="line">writer.println(<span class="string">"xxx"</span>)</span><br><span class="line"> </span><br><span class="line">writer.flush()</span><br><span class="line">writer.close</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意，关闭流前，先刷新。PrintWriter 不支持追加，FileWriter 支持追加，但存在换行问题。可以将 FileWriter 包装成 BufferedWriter 或 PrintWriter 解决换行问题。</p>
</blockquote>
<p>##参考</p>
<ul>
<li><a href="http://www.scala-lang.org/" target="_blank" rel="noopener">Scala官网</a>；</li>
<li><a href="http://www.runoob.com/scala/scala-tutorial.html" target="_blank" rel="noopener">Scala | 菜鸟教程</a>； <a href="http://www.yiibai.com/scala/" target="_blank" rel="noopener">Scala | 易佰教程</a>；</li>
<li><a href="http://www.zezhi.net/cat/scala2" target="_blank" rel="noopener">Scala - ZeZhi.net</a>；</li>
<li><a href="http://docs.scala-lang.org/tutorials/scala-for-java-programmers.html" target="_blank" rel="noopener">A Scala Tutorial for Java Programmers</a>；</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://longzl2015.github.io/2018/01/04/2%E8%AF%AD%E8%A8%80/scala/%E6%96%B9%E6%B3%95%E5%8F%82%E6%95%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="zhoul">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2018/01/04/2%E8%AF%AD%E8%A8%80/scala/%E6%96%B9%E6%B3%95%E5%8F%82%E6%95%B0/" class="post-title-link" itemprop="url">scala方法参数</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-01-05 03:30:09" itemprop="dateCreated datePublished" datetime="2018-01-05T03:30:09+08:00">2018-01-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-02-27 17:16:07" itemprop="dateModified" datetime="2020-02-27T17:16:07+08:00">2020-02-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AF%AD%E8%A8%80/" itemprop="url" rel="index">
                    <span itemprop="name">语言</span>
                  </a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AF%AD%E8%A8%80/scala/" itemprop="url" rel="index">
                    <span itemprop="name">scala</span>
                  </a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2018/01/04/2%E8%AF%AD%E8%A8%80/scala/%E6%96%B9%E6%B3%95%E5%8F%82%E6%95%B0/#comments" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2018/01/04/2语言/scala/方法参数/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="方法参数"><a href="#方法参数" class="headerlink" title="方法参数"></a>方法参数</h1><h3 id="一、普通参数"><a href="#一、普通参数" class="headerlink" title="一、普通参数"></a>一、普通参数</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">addInt</span></span>( a:<span class="type">Int</span>, b:<span class="type">Int</span> ) : <span class="type">Int</span> = &#123;</span><br><span class="line">      <span class="keyword">var</span> sum:<span class="type">Int</span> = <span class="number">0</span></span><br><span class="line">      sum = a + b</span><br><span class="line">      <span class="keyword">return</span> sum</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h3 id="二、传值调用和传名调用-gt"><a href="#二、传值调用和传名调用-gt" class="headerlink" title="二、传值调用和传名调用: =&gt;"></a>二、传值调用和传名调用: =&gt;</h3><p>两者的区别主要在于变量名和变量类型之间是否多了一个 <strong>=&gt;</strong></p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]) &#123;</span><br><span class="line">        delayed(time());</span><br><span class="line">        delayed2(time());</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">def</span> <span class="title">time</span></span>() = &#123;</span><br><span class="line">      println(<span class="string">"获取时间，单位为纳秒"</span>)</span><br><span class="line">      <span class="type">System</span>.nanoTime</span><br><span class="line">   &#125;</span><br><span class="line">    <span class="comment">// 传名调用</span></span><br><span class="line">   <span class="function"><span class="keyword">def</span> <span class="title">delayed2</span></span>( t: =&gt; <span class="type">Long</span> ) = &#123;</span><br><span class="line">      println(<span class="string">"在 delayed 方法内"</span>)</span><br><span class="line">      println(<span class="string">"参数： "</span> + t)</span><br><span class="line">      t</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">// 传值调用</span></span><br><span class="line">   <span class="function"><span class="keyword">def</span> <span class="title">delayed</span></span>( t: <span class="type">Long</span> ) = &#123;</span><br><span class="line">      println(<span class="string">"在 delayed 方法内"</span>)</span><br><span class="line">      println(<span class="string">"参数： "</span> + t)</span><br><span class="line">      t</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="三、参数顺序"><a href="#三、参数顺序" class="headerlink" title="三、参数顺序"></a>三、参数顺序</h3><p>通过在调用者端添加 </p>
<p><strong>参数名=</strong></p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]) &#123;</span><br><span class="line">        printInt(b=<span class="number">5</span>, a=<span class="number">7</span>);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="function"><span class="keyword">def</span> <span class="title">printInt</span></span>( a:<span class="type">Int</span>, b:<span class="type">Int</span> ) = &#123;</span><br><span class="line">      println(<span class="string">"Value of a : "</span> + a );</span><br><span class="line">      println(<span class="string">"Value of b : "</span> + b );</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="四、可变参数"><a href="#四、可变参数" class="headerlink" title="四、可变参数"></a>四、可变参数</h3><p>感觉就是一个数组</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]) &#123;</span><br><span class="line">        printStrings(<span class="string">"Runoob"</span>, <span class="string">"Scala"</span>, <span class="string">"Python"</span>);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="function"><span class="keyword">def</span> <span class="title">printStrings</span></span>( args:<span class="type">String</span>* ) = &#123;</span><br><span class="line">      <span class="keyword">var</span> i : <span class="type">Int</span> = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">for</span>( arg &lt;- args )&#123;</span><br><span class="line">         println(<span class="string">"Arg value["</span> + i + <span class="string">"] = "</span> + arg );</span><br><span class="line">         i = i + <span class="number">1</span>;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="五、默认参数"><a href="#五、默认参数" class="headerlink" title="五、默认参数"></a>五、默认参数</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]) &#123;</span><br><span class="line">        println( <span class="string">"返回值 : "</span> + addInt() );</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="function"><span class="keyword">def</span> <span class="title">addInt</span></span>( a:<span class="type">Int</span>=<span class="number">5</span>, b:<span class="type">Int</span>=<span class="number">7</span> ) : <span class="type">Int</span> = &#123;</span><br><span class="line">      <span class="keyword">var</span> sum:<span class="type">Int</span> = <span class="number">0</span></span><br><span class="line">      sum = a + b</span><br><span class="line">      <span class="keyword">return</span> sum</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="六、高阶函数"><a href="#六、高阶函数" class="headerlink" title="六、高阶函数"></a>六、高阶函数</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]) &#123;<span class="number">7</span></span><br><span class="line">      println( apply( layout, <span class="number">10</span>) )</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">// 函数 f 和 值 v 作为参数，而函数 f 又调用了参数 v</span></span><br><span class="line">   <span class="function"><span class="keyword">def</span> <span class="title">apply</span></span>(f: =&gt; <span class="type">String</span>, v: <span class="type">Int</span>) = f(v)</span><br><span class="line">   <span class="comment">// 泛型</span></span><br><span class="line">   <span class="function"><span class="keyword">def</span> <span class="title">layout</span></span>[<span class="type">A</span>](x: <span class="type">A</span>) = <span class="string">"["</span> + x.toString() + <span class="string">"]"</span></span><br><span class="line">   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="七、匿名函数"><a href="#七、匿名函数" class="headerlink" title="七、匿名函数"></a>七、匿名函数</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> inc = (x:<span class="type">Int</span>) =&gt; x+<span class="number">1</span></span><br><span class="line">print(inc(<span class="number">2</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> userDir = () =&gt; &#123; <span class="type">System</span>.getProperty(<span class="string">"user.dir"</span>) &#125;</span><br><span class="line">println( userDir() )</span><br></pre></td></tr></table></figure>

<h3 id="八、偏函数"><a href="#八、偏函数" class="headerlink" title="八、偏函数"></a>八、偏函数</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.<span class="type">Date</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]) &#123;</span><br><span class="line">      <span class="keyword">val</span> date = <span class="keyword">new</span> <span class="type">Date</span></span><br><span class="line">      <span class="keyword">val</span> logWithDateBound = log(date, _ : <span class="type">String</span>)</span><br><span class="line"></span><br><span class="line">      logWithDateBound(<span class="string">"message1"</span> )</span><br><span class="line">      <span class="type">Thread</span>.sleep(<span class="number">1000</span>)</span><br><span class="line">      logWithDateBound(<span class="string">"message2"</span> )</span><br><span class="line">      <span class="type">Thread</span>.sleep(<span class="number">1000</span>)</span><br><span class="line">      logWithDateBound(<span class="string">"message3"</span> )</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">def</span> <span class="title">log</span></span>(date: <span class="type">Date</span>, message: <span class="type">String</span>)  = &#123;</span><br><span class="line">     println(date + <span class="string">"----"</span> + message)</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://longzl2015.github.io/2018/01/04/4%E6%95%B0%E6%8D%AE%E5%BA%93/rdbms/db2/%E4%BD%BF%E7%94%A8bat%E8%BF%9B%E8%A1%8C%E6%89%B9%E9%87%8F%E5%AF%BC%E5%85%A5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="zhoul">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2018/01/04/4%E6%95%B0%E6%8D%AE%E5%BA%93/rdbms/db2/%E4%BD%BF%E7%94%A8bat%E8%BF%9B%E8%A1%8C%E6%89%B9%E9%87%8F%E5%AF%BC%E5%85%A5/" class="post-title-link" itemprop="url">db2 使用bat脚本批量导入</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-01-05 03:30:09" itemprop="dateCreated datePublished" datetime="2018-01-05T03:30:09+08:00">2018-01-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-02-27 17:16:07" itemprop="dateModified" datetime="2020-02-27T17:16:07+08:00">2020-02-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url" rel="index">
                    <span itemprop="name">数据库</span>
                  </a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/rdbms/" itemprop="url" rel="index">
                    <span itemprop="name">rdbms</span>
                  </a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/rdbms/db2/" itemprop="url" rel="index">
                    <span itemprop="name">db2</span>
                  </a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2018/01/04/4%E6%95%B0%E6%8D%AE%E5%BA%93/rdbms/db2/%E4%BD%BF%E7%94%A8bat%E8%BF%9B%E8%A1%8C%E6%89%B9%E9%87%8F%E5%AF%BC%E5%85%A5/#comments" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2018/01/04/4数据库/rdbms/db2/使用bat进行批量导入/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>运行 bat ，调用sql文件即可。</p>
<h3 id="创建bat文件"><a href="#创建bat文件" class="headerlink" title="创建bat文件"></a>创建bat文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@echo off</span><br><span class="line">echo ###用生成的文件操作DB2数据库###</span><br><span class="line">db2cmd db2 -tvf &quot;importall.sql&quot; -l import.log</span><br><span class="line">pause</span><br></pre></td></tr></table></figure>

<h3 id="创建sql文件"><a href="#创建sql文件" class="headerlink" title="创建sql文件"></a>创建sql文件</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">connect to zl user test using testtest;</span><br><span class="line"><span class="keyword">load</span> <span class="keyword">client</span> <span class="keyword">from</span> <span class="string">'E:\zds\czj_data\test-20091029'</span> <span class="keyword">of</span> del <span class="keyword">insert</span> <span class="keyword">into</span> test_tmp;</span><br><span class="line"><span class="keyword">update</span> CCARD.card <span class="keyword">set</span> SPLIT_DATE = <span class="string">'20161111'</span> <span class="keyword">where</span> SPLIT_DATE <span class="keyword">is</span> <span class="literal">null</span> </span><br><span class="line"><span class="keyword">connect</span> <span class="keyword">reset</span>;</span><br></pre></td></tr></table></figure>

<h3 id="db2cmd-部分参数"><a href="#db2cmd-部分参数" class="headerlink" title="db2cmd 部分参数"></a>db2cmd 部分参数</h3><ul>
<li>-c       执行 DB2 命令窗口，然后终止。<br> -w      一直等到 DB2 命令窗口终止。<br>  -i         从进行调用的 shell 继承环境。<br>  -t       从进行调用的 shell 继承标题。</li>
</ul>
<h3 id="db2-部分参数"><a href="#db2-部分参数" class="headerlink" title="db2 部分参数"></a>db2 部分参数</h3><ul>
<li>-t 指明在缺省情况下用分号（;）终止每条命令 </li>
<li>-v 指明应将每条命令显示到标准输出 </li>
<li>-f 指明从输入文件读取命令 </li>
<li>-l 指明将命令记录到输出文件中 </li>
<li>-r 指明将结果保存到报告文件中 </li>
<li>-s stop commands on command error</li>
</ul>
<p>更多参数请访问 <a href="https://www.ibm.com/support/knowledgecenter/SSEPGG_9.7.0/com.ibm.db2.luw.admin.cmd.doc/doc/r0010410.html" target="_blank" rel="noopener">db2 命令 options</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://longzl2015.github.io/2017/08/04/6%E9%9D%A2%E8%AF%95/%E6%95%B4%E7%90%86%E9%9D%A2%E8%AF%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="zhoul">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2017/08/04/6%E9%9D%A2%E8%AF%95/%E6%95%B4%E7%90%86%E9%9D%A2%E8%AF%95/" class="post-title-link" itemprop="url">整理面试</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-08-05 03:36:18" itemprop="dateCreated datePublished" datetime="2017-08-05T03:36:18+08:00">2017-08-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-02-27 17:16:07" itemprop="dateModified" datetime="2020-02-27T17:16:07+08:00">2020-02-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E9%9D%A2%E8%AF%95/" itemprop="url" rel="index">
                    <span itemprop="name">面试</span>
                  </a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2017/08/04/6%E9%9D%A2%E8%AF%95/%E6%95%B4%E7%90%86%E9%9D%A2%E8%AF%95/#comments" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2017/08/04/6面试/整理面试/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>[TOC]</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2017/08/04/6%E9%9D%A2%E8%AF%95/%E6%95%B4%E7%90%86%E9%9D%A2%E8%AF%95/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://longzl2015.github.io/2017/08/04/2%E8%AF%AD%E8%A8%80/java/%E5%BA%8F%E5%88%97%E5%8C%96/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="zhoul">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2017/08/04/2%E8%AF%AD%E8%A8%80/java/%E5%BA%8F%E5%88%97%E5%8C%96/" class="post-title-link" itemprop="url">序列化与反序列化</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-08-05 03:30:09" itemprop="dateCreated datePublished" datetime="2017-08-05T03:30:09+08:00">2017-08-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-02-27 17:16:07" itemprop="dateModified" datetime="2020-02-27T17:16:07+08:00">2020-02-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AF%AD%E8%A8%80/" itemprop="url" rel="index">
                    <span itemprop="name">语言</span>
                  </a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AF%AD%E8%A8%80/java/" itemprop="url" rel="index">
                    <span itemprop="name">java</span>
                  </a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AF%AD%E8%A8%80/java/%E5%85%B6%E4%BB%96/" itemprop="url" rel="index">
                    <span itemprop="name">其他</span>
                  </a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2017/08/04/2%E8%AF%AD%E8%A8%80/java/%E5%BA%8F%E5%88%97%E5%8C%96/#comments" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2017/08/04/2语言/java/序列化/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>对象<em>序列化（serialization）</em>和<em>反序列化（deserialization）</em>是将对象转化为便于传输的格式进行发送和接收的两个操作。常见的序列化格式有字节数组，json字符串，xml字符串等。</p>
<p>本次讨论的是java中的对象<strong>字节序列化</strong></p>
<h2 id="1-序列化方法"><a href="#1-序列化方法" class="headerlink" title="1.序列化方法"></a>1.序列化方法</h2><p>使用此方法进行序列化的对象必须实现<strong>Serializable接口</strong>，不然在进行序列化时会抛出<strong>NotSerializableException</strong>异常。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">byte</span>[] toBytes(Serializable obj) <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="keyword">try</span>(ByteArrayOutputStream byteArrayOutputStream = <span class="keyword">new</span> ByteArrayOutputStream();</span><br><span class="line">        ObjectOutputStream objectOutputStream = <span class="keyword">new</span> ObjectOutputStream(byteArrayOutputStream);</span><br><span class="line">    )&#123;</span><br><span class="line">        objectOutputStream.writeObject(obj);</span><br><span class="line">        <span class="keyword">return</span> byteArrayOutputStream.toByteArray();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ObjectOutputStream的writeObject方法将对象序列化后写入一个字节流中，而这个字节流就是在初始化ObjectOutputStream对象时传入的字节流，这里使用ByteArrayOutputStream，可以获取到字节流中的字节数组。</p>
<h2 id="2-反序列化方法"><a href="#2-反序列化方法" class="headerlink" title="2.反序列化方法"></a>2.反序列化方法</h2><p>对应序列化，反序列化应该是将字节数组转化为对象。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Serializable <span class="title">toObj</span><span class="params">(<span class="keyword">byte</span>[] bytes)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException </span>&#123;</span><br><span class="line">    <span class="keyword">try</span>(ByteArrayInputStream byteArrayInputStream = <span class="keyword">new</span> ByteArrayInputStream(bytes);</span><br><span class="line">        ObjectInputStream objectInputStream = <span class="keyword">new</span> ObjectInputStream(byteArrayInputStream);</span><br><span class="line">    )&#123; </span><br><span class="line">        Object o = objectInputStream.readObject();</span><br><span class="line">        <span class="keyword">return</span> (Serializable) o;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ByteArrayInputStream将字节数组转化为字节流。而ObjectInputStream的readObject方法将字节流转化为对象。</p>
<h2 id="3-序列化例子"><a href="#3-序列化例子" class="headerlink" title="3.序列化例子"></a>3.序列化例子</h2><p>建立一个Student类，并实现Serializable接口。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> <span class="keyword">implements</span> <span class="title">Serializable</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String code;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Student&#123;"</span> +</span><br><span class="line">                <span class="string">"id="</span> + id +</span><br><span class="line">                <span class="string">", code='"</span> + code + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", name='"</span> + name + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//省略set/get方法</span></span><br><span class="line">···</span><br></pre></td></tr></table></figure>

<p>测试代码:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建student对象</span></span><br><span class="line">Student student = <span class="keyword">new</span> Student(<span class="number">1</span>,<span class="string">"2014213880"</span>,<span class="string">"刘瑞杰"</span>);</span><br><span class="line"><span class="comment">//序列化</span></span><br><span class="line"><span class="keyword">byte</span>[] bytes = toBytes(student);</span><br><span class="line">System.out.println(bytes.length);</span><br><span class="line"><span class="comment">//反序列化</span></span><br><span class="line">Student student0 = (Student) toObj(bytes);</span><br><span class="line">System.out.println(student0);</span><br></pre></td></tr></table></figure>

<p>输出结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">111</span><br><span class="line">Student&#123;id&#x3D;1, code&#x3D;&#39;2014213880&#39;, name&#x3D;&#39;刘瑞杰&#39;&#125;</span><br></pre></td></tr></table></figure>

<h1 id="4-关于serialVersionUID"><a href="#4-关于serialVersionUID" class="headerlink" title="4.关于serialVersionUID"></a>4.关于serialVersionUID</h1><blockquote>
<p>serialVersionUID 这个变量，如果不赋值，JAVA会自动根据类的相关信息自动生成。</p>
</blockquote>
<p>现在设想一个场景，如果将对象序列化后，并没有马上反序列化，而是将对象保存到文件中，然后修改类的定义，比如在Student类中加一个字段，然后进行反序列化。</p>
<p>这时就是出现异常：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Exception in thread <span class="string">"main"</span> java.io.InvalidClassException: serilize.Student;</span><br><span class="line"> local class incompatible: </span><br><span class="line">stream classdesc serialVersionUID = <span class="number">6643383736516292602</span>, </span><br><span class="line">local <span class="class"><span class="keyword">class</span> <span class="title">serialVersionUID</span> </span>= -<span class="number">1315177638240754633</span></span><br></pre></td></tr></table></figure>

<h3 id="4-1-为什么时出现这种情况呢？"><a href="#4-1-为什么时出现这种情况呢？" class="headerlink" title="4.1 为什么时出现这种情况呢？"></a>4.1 为什么时出现这种情况呢？</h3><p>当进行序列化操作时，JAVA会记录类的serialVersionUID，如果没有设置，则会根据类的信息自动生成一份serialVersionUID。</p>
<p>当进行反序列化时，同样会根据类信息自动生成serialVersionUID。</p>
<p>如果在序列化后 类的相关字段被修改，那么生成的serialVersionUID就会与原先的不同，这就会引起InvalidClassException</p>
<h3 id="4-2-如何避免InvalidClassException"><a href="#4-2-如何避免InvalidClassException" class="headerlink" title="4.2 如何避免InvalidClassException"></a>4.2 如何避免InvalidClassException</h3><p>设置 serialVersionUID值即可。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br></pre></td></tr></table></figure>

<h2 id="5-关于transient"><a href="#5-关于transient" class="headerlink" title="5. 关于transient"></a>5. 关于transient</h2><p>如果用transient声明一个实例变量，当对象存储时，它的值不需要维持。换句话来说就是，用transient关键字标记的成员变量不参与序列化过程。</p>
<h2 id="6-静态成员变量"><a href="#6-静态成员变量" class="headerlink" title="6. 静态成员变量"></a>6. 静态成员变量</h2><p>由于静态变量是类级别的，在序列化过程中，静态变量会被忽略，并不参与序列化过程。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://longzl2015.github.io/2017/06/04/quartz/%E4%B8%8D%E5%90%8C%E4%BB%BB%E5%8A%A1%E4%B9%8B%E9%97%B4%E7%9A%84%E4%B8%B2%E8%A1%8C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="zhoul">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2017/06/04/quartz/%E4%B8%8D%E5%90%8C%E4%BB%BB%E5%8A%A1%E4%B9%8B%E9%97%B4%E7%9A%84%E4%B8%B2%E8%A1%8C/" class="post-title-link" itemprop="url">不同任务之间的串行</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-06-04 23:22:58" itemprop="dateCreated datePublished" datetime="2017-06-04T23:22:58+08:00">2017-06-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-02-27 17:16:07" itemprop="dateModified" datetime="2020-02-27T17:16:07+08:00">2020-02-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/quartz/" itemprop="url" rel="index">
                    <span itemprop="name">quartz</span>
                  </a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2017/06/04/quartz/%E4%B8%8D%E5%90%8C%E4%BB%BB%E5%8A%A1%E4%B9%8B%E9%97%B4%E7%9A%84%E4%B8%B2%E8%A1%8C/#comments" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2017/06/04/quartz/不同任务之间的串行/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="串行执行不同tasks"><a href="#串行执行不同tasks" class="headerlink" title="串行执行不同tasks"></a>串行执行不同tasks</h1><p><strong>一、监听器</strong></p>
<p>使用监听器（TriggerListener, JobListener or SchedulerListener）</p>
<p>通过在 <strong>JobListener.jobWasExecuted()</strong> 中 立即执行一个新的任务。</p>
<p>这种方法可能侵入性比较强，因为需要在监听器中定义任务的关联关系和需要考虑任务信息的持久化。</p>
<blockquote>
<p>One way is to use a listener (i.e. a TriggerListener, JobListener or SchedulerListener) that can notice the completion of a job/trigger and then immediately schedule a new trigger to fire. This approach can get a bit involved, since you’ll have to inform the listener which job follows which and you may need to worry about persistence of this information.</p>
</blockquote>
<p>二、使用 JobDataMap</p>
<p>在 JobData 中保存下一个执行任务的标识，在执行的最后执行下一个任务。</p>
<blockquote>
<p>Another way is to build a Job that contains within its JobDataMap the name of the next job to fire, and as the job completes (the last step in its Execute() method) have the job schedule the next job. </p>
</blockquote>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://longzl2015.github.io/2017/06/04/quartz/%E5%90%8C%E4%B8%80%E4%BB%BB%E5%8A%A1%E4%B8%B2%E8%A1%8C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="zhoul">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2017/06/04/quartz/%E5%90%8C%E4%B8%80%E4%BB%BB%E5%8A%A1%E4%B8%B2%E8%A1%8C/" class="post-title-link" itemprop="url">同一任务并发执行与数据共享</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-06-04 23:22:58" itemprop="dateCreated datePublished" datetime="2017-06-04T23:22:58+08:00">2017-06-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-02-27 17:16:07" itemprop="dateModified" datetime="2020-02-27T17:16:07+08:00">2020-02-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/quartz/" itemprop="url" rel="index">
                    <span itemprop="name">quartz</span>
                  </a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2017/06/04/quartz/%E5%90%8C%E4%B8%80%E4%BB%BB%E5%8A%A1%E4%B8%B2%E8%A1%8C/#comments" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2017/06/04/quartz/同一任务串行/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>#同一任务并发执行与数据共享<br>@(springboot)[quartz]</p>
<p>[TOC]</p>
<h2 id="1-禁止同一个-JobDetail-中的多个实例并发执行"><a href="#1-禁止同一个-JobDetail-中的多个实例并发执行" class="headerlink" title="1. 禁止同一个 JobDetail 中的多个实例并发执行"></a>1. 禁止同一个 JobDetail 中的多个实例并发执行</h2><p>Quartz 定时任务默认都是并发执行的，不会等待上一次任务执行完毕，只要间隔时间到就会执行。</p>
<p><strong>注</strong> <strong>同一任务</strong>的含义指同一个<strong>JobKey</strong> 。</p>
<h3 id="1-1-方法一、使用-xml"><a href="#1-1-方法一、使用-xml" class="headerlink" title="1.1 方法一、使用 xml"></a>1.1 方法一、使用 xml</h3><p>Spring 配置文件中加入：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"resultJobDetail"</span> <span class="attr">class</span>=<span class="string">"org.springframework.scheduling.quartz.MethodInvokingJobDetailFactoryBean"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 调用的类 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"targetObject"</span> <span class="attr">ref</span>=<span class="string">"resultJob"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 调用类中的方法 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"targetMethod"</span> <span class="attr">value</span>=<span class="string">"createDemEmps"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- false 表示等上一个任务执行完后再开启新的任务 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"concurrent"</span> <span class="attr">value</span>=<span class="string">"false"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="1-2-方法二、使用注解"><a href="#1-2-方法二、使用注解" class="headerlink" title="1.2 方法二、使用注解"></a>1.2 方法二、使用注解</h3><p>当不使用 Spring 的时候，只需要在 Job 的实现类上加 @DisallowConcurrentExecution 的注解。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@DisallowConcurrentExecution</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DaemonExecutionSchedule</span> <span class="keyword">implements</span> <span class="title">Job</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Logger logger = LoggerFactory.getLogger(<span class="keyword">this</span>.getClass());</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">(JobExecutionContext context)</span> <span class="keyword">throws</span> JobExecutionException </span>&#123;</span><br><span class="line">      ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-同一个-JobDetail-中多个实例的数据共享"><a href="#2-同一个-JobDetail-中多个实例的数据共享" class="headerlink" title="2. 同一个 JobDetail 中多个实例的数据共享"></a>2. 同一个 JobDetail 中多个实例的数据共享</h2><p>@PersistJobDataAfterExecution 是用在 Job 实现类上，表示一个有状态的任务，意思是当正常执行完 Job 后，JobDataMap 中的数据应该被改动，以被下一次调用时用。</p>
<p><strong>注意：</strong>当使用 @PersistJobDataAfterExecution 注解时，为了避免并发时，存储数据造成混乱，强烈建议把 @DisallowConcurrentExecution 注解也加上。</p>
<h2 id="3-示例"><a href="#3-示例" class="headerlink" title="3. 示例"></a>3. 示例</h2><p>假设定时任务的时间间隔为 3 秒，但 job 执行时间是 10 秒。当设置 @DisallowConcurrentExecution 以后程序会等任务执行完毕后再去执行。</p>
<p>当设置 @PersistJobDataAfterExecution 时，在执行完 Job 的 execution 方法后保存 JobDataMap 当中固定数据，以便任务在重复执行的时候具有相同的 JobDataMap；在默认情况下也就是没有设置 @PersistJobDataAfterExecution 的时候每个 job 都拥有独立 JobDataMap。</p>
<p>任务类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.quartz.examples;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.quartz.*;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="meta">@PersistJobDataAfterExecution</span></span><br><span class="line"><span class="meta">@DisallowConcurrentExecution</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TaskJob</span> <span class="keyword">implements</span> <span class="title">Job</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String NUM_EXECUTIONS = <span class="string">"NumExecutions"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String EXECUTION_DELAY = <span class="string">"ExecutionDelay"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 静态变量可以保持工作状态，但无法达到预期效果</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> _staticCounter = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * Quartz 每次执行作业时都会重新实例化，非静态变量无法保持工作状态</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> _counter = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 需要一个公共的空构造方法，以便 scheduler 随时实例化 job</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TaskJob</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 该方法实现需要执行的任务</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">(JobExecutionContext context)</span> <span class="keyword">throws</span> JobExecutionException </span>&#123;</span><br><span class="line">        System.err.println(<span class="string">"---&gt; "</span> + context.getJobDetail().getKey() + <span class="string">" 运行中["</span> + <span class="keyword">new</span> Date() + <span class="string">"]"</span>);</span><br><span class="line"></span><br><span class="line">        JobDataMap map = context.getJobDetail().getJobDataMap();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> executeCount = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (map.containsKey(NUM_EXECUTIONS)) &#123;</span><br><span class="line">            executeCount = map.getInt(NUM_EXECUTIONS);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 增量计数并将其存储回 JobDataMap，这样可以适当保持工作状态</span></span><br><span class="line">        executeCount++;</span><br><span class="line">        map.put(NUM_EXECUTIONS, executeCount);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 只要有任务执行都会递增，无法达到预期效果</span></span><br><span class="line">        _staticCounter++;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 本地变量递增加，但实际上无法保持工作状态</span></span><br><span class="line">        _counter++;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">long</span> delay = <span class="number">5000L</span>;</span><br><span class="line">        <span class="keyword">if</span> (map.containsKey(EXECUTION_DELAY)) &#123;</span><br><span class="line">            delay = map.getLong(EXECUTION_DELAY);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 模拟一个耗时的 job</span></span><br><span class="line">            Thread.sleep(delay);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.err.println(context.getJobDetail().getKey() + <span class="string">" 的静态变量 _staticCounter 为："</span> + _staticCounter + <span class="string">"，非静态变量 scheduler 为："</span> + _counter);</span><br><span class="line">        System.err.println(context.getJobDetail().getKey() + <span class="string">" 完成了（"</span> + executeCount + <span class="string">"）次 &lt;---"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>任务调度类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.quartz.examples;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.quartz.*;</span><br><span class="line"><span class="keyword">import</span> org.quartz.impl.StdSchedulerFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Executer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// 通过 schedulerFactory 获取一个调度器</span></span><br><span class="line">        SchedulerFactory sf = <span class="keyword">new</span> StdSchedulerFactory();</span><br><span class="line">        Scheduler sched = sf.getScheduler();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建 jobDetail 实例，绑定 Job 实现类</span></span><br><span class="line">        <span class="comment">// 指明 job 的名称，所在组的名称，以及绑定 job 类</span></span><br><span class="line">        JobDetail job1 = JobBuilder.newJob(TaskJob<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line">                .withIdentity("statefulJob1", "group1")</span><br><span class="line">                <span class="comment">// 给定的键-值对添加到 JobDetail 的 JobDataMap 中</span></span><br><span class="line">                .usingJobData(TaskJob.EXECUTION_DELAY, <span class="number">10000L</span>).build();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 定义调度触发规则，先立即执行一次，然后每隔 3 秒执行一次</span></span><br><span class="line">        SimpleTrigger trigger = TriggerBuilder.newTrigger()</span><br><span class="line">                .withIdentity(<span class="string">"trigger1"</span>, <span class="string">"group1"</span>)</span><br><span class="line">                .startNow()</span><br><span class="line">                .withSchedule(SimpleScheduleBuilder.simpleSchedule()</span><br><span class="line">                        .withIntervalInSeconds(<span class="number">3</span>)</span><br><span class="line">                        .repeatForever())</span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 把作业和触发器注册到任务调度中</span></span><br><span class="line">        Date firstRunTime = sched.scheduleJob(job1, trigger);</span><br><span class="line">        System.out.println(job1.getKey() + <span class="string">" 开始运行于："</span> + firstRunTime + <span class="string">"，重复："</span> + trigger.getRepeatCount() + <span class="string">" 次，每次间隔 "</span></span><br><span class="line">                + trigger.getRepeatInterval() / <span class="number">1000</span> + <span class="string">" 秒"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 任务 job1 方法中拿到的 JobDataMap 的数据是共享的</span></span><br><span class="line">        <span class="comment">// 这里要注意一个情况： 就是 JobDataMap 的数据共享只针对一个 job1 任务</span></span><br><span class="line">        <span class="comment">// 如果在下面在新增加一个任务 那么他们之间是不共享的，比如下面的 job2</span></span><br><span class="line">        <span class="comment">// 创建第二个 JobDetail 实例</span></span><br><span class="line">        JobDetail job2 = JobBuilder.newJob(TaskJob<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line">                .withIdentity("statefulJob2", "group1")</span><br><span class="line">                <span class="comment">// 给定的键-值对添加到 JobDetail 的 JobDataMap 中</span></span><br><span class="line">                .usingJobData(TaskJob.EXECUTION_DELAY, <span class="number">10000L</span>)</span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 定义调度触发规则，先立即执行一次，然后每隔 3 秒执行一次</span></span><br><span class="line">        trigger = TriggerBuilder.newTrigger()</span><br><span class="line">                .withIdentity(<span class="string">"trigger2"</span>, <span class="string">"group1"</span>)</span><br><span class="line">                .startNow()</span><br><span class="line">                .withSchedule(SimpleScheduleBuilder.simpleSchedule().</span><br><span class="line">                        withIntervalInSeconds(<span class="number">3</span>)</span><br><span class="line">                        .repeatForever()</span><br><span class="line">                        <span class="comment">// 指定失效时的策略</span></span><br><span class="line">                        .withMisfireHandlingInstructionNowWithExistingCount())</span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 这个 job2 与 job1 执行的 JobDataMap 不共享</span></span><br><span class="line">        <span class="comment">// 把作业和触发器注册到任务调度中</span></span><br><span class="line">        firstRunTime = sched.scheduleJob(job2, trigger);</span><br><span class="line">        System.out.println(job2.getKey() + <span class="string">" 开始运行于："</span> + firstRunTime + <span class="string">"，重复："</span> + trigger.getRepeatCount() + <span class="string">" 次，每次间隔 "</span></span><br><span class="line">                + trigger.getRepeatInterval() / <span class="number">1000</span> + <span class="string">" 秒"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 启动计划程序（实际上直到调度器已经启动才会开始运行）</span></span><br><span class="line">        sched.start();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 等待 60 秒，使我们的 job 有机会执行</span></span><br><span class="line">        Thread.sleep(<span class="number">60000</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 等待作业执行完成时才关闭调度器</span></span><br><span class="line">        sched.shutdown(<span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">        SchedulerMetaData metaData = sched.getMetaData();</span><br><span class="line">        System.out.println(<span class="string">"一共运行了："</span> + metaData.getNumberOfJobsExecuted() + <span class="string">" 个任务"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Executer example = <span class="keyword">new</span> Executer();</span><br><span class="line">        example.run();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">group1.statefulJob1 开始运行于：Wed Apr 19 17:04:22 CST 2017，重复：-1 次，每次间隔 3 秒</span><br><span class="line">group1.statefulJob2 开始运行于：Wed Apr 19 17:04:22 CST 2017，重复：-1 次，每次间隔 3 秒</span><br><span class="line"></span><br><span class="line">---&gt; group1.statefulJob2 运行中[Wed Apr 19 17:04:22 CST 2017]</span><br><span class="line">---&gt; group1.statefulJob1 运行中[Wed Apr 19 17:04:22 CST 2017]</span><br><span class="line">group1.statefulJob2 的静态变量 _staticCounter 为：2，非静态变量 scheduler 为：1</span><br><span class="line">group1.statefulJob1 的静态变量 _staticCounter 为：2，非静态变量 scheduler 为：1</span><br><span class="line">group1.statefulJob2 完成了（1）次 &lt;---</span><br><span class="line">group1.statefulJob1 完成了（1）次 &lt;---</span><br><span class="line">---&gt; group1.statefulJob1 运行中[Wed Apr 19 17:04:32 CST 2017]</span><br><span class="line">---&gt; group1.statefulJob2 运行中[Wed Apr 19 17:04:32 CST 2017]</span><br><span class="line">group1.statefulJob1 的静态变量 _staticCounter 为：4，非静态变量 scheduler 为：1</span><br><span class="line">group1.statefulJob1 完成了（2）次 &lt;---</span><br><span class="line">group1.statefulJob2 的静态变量 _staticCounter 为：4，非静态变量 scheduler 为：1</span><br><span class="line">group1.statefulJob2 完成了（2）次 &lt;---</span><br><span class="line">---&gt; group1.statefulJob1 运行中[Wed Apr 19 17:04:42 CST 2017]</span><br><span class="line">---&gt; group1.statefulJob2 运行中[Wed Apr 19 17:04:42 CST 2017]</span><br><span class="line">group1.statefulJob2 的静态变量 _staticCounter 为：6，非静态变量 scheduler 为：1</span><br><span class="line">group1.statefulJob1 的静态变量 _staticCounter 为：6，非静态变量 scheduler 为：1</span><br><span class="line">group1.statefulJob1 完成了（3）次 &lt;---</span><br><span class="line">group1.statefulJob2 完成了（3）次 &lt;---</span><br><span class="line">---&gt; group1.statefulJob1 运行中[Wed Apr 19 17:04:52 CST 2017]</span><br><span class="line">---&gt; group1.statefulJob2 运行中[Wed Apr 19 17:04:52 CST 2017]</span><br><span class="line">group1.statefulJob2 的静态变量 _staticCounter 为：8，非静态变量 scheduler 为：1</span><br><span class="line">group1.statefulJob2 完成了（4）次 &lt;---</span><br><span class="line">group1.statefulJob1 的静态变量 _staticCounter 为：8，非静态变量 scheduler 为：1</span><br><span class="line">group1.statefulJob1 完成了（4）次 &lt;---</span><br><span class="line">---&gt; group1.statefulJob2 运行中[Wed Apr 19 17:05:02 CST 2017]</span><br><span class="line">---&gt; group1.statefulJob1 运行中[Wed Apr 19 17:05:02 CST 2017]</span><br><span class="line">group1.statefulJob2 的静态变量 _staticCounter 为：10，非静态变量 scheduler 为：1</span><br><span class="line">group1.statefulJob1 的静态变量 _staticCounter 为：10，非静态变量 scheduler 为：1</span><br><span class="line">group1.statefulJob2 完成了（5）次 &lt;---</span><br><span class="line">group1.statefulJob1 完成了（5）次 &lt;---</span><br><span class="line">---&gt; group1.statefulJob1 运行中[Wed Apr 19 17:05:12 CST 2017]</span><br><span class="line">---&gt; group1.statefulJob2 运行中[Wed Apr 19 17:05:12 CST 2017]</span><br><span class="line"></span><br><span class="line">group1.statefulJob2 的静态变量 _staticCounter 为：12，非静态变量 scheduler 为：1</span><br><span class="line">group1.statefulJob2 完成了（6）次 &lt;---</span><br><span class="line">group1.statefulJob1 的静态变量 _staticCounter 为：12，非静态变量 scheduler 为：1</span><br><span class="line">group1.statefulJob1 完成了（6）次 &lt;---</span><br></pre></td></tr></table></figure>

<p>一共运行了：12 个任务</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

  </div>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/26/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/26/">26</a><span class="page-number current">27</span><a class="page-number" href="/page/28/">28</a><span class="space">&hellip;</span><a class="page-number" href="/page/36/">36</a><a class="extend next" rel="next" href="/page/28/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">zhoul</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">351</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">92</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">190</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/longzl2015" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;longzl2015" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:289570126@qq.com" title="E-Mail → mailto:289570126@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://stackoverflow.com/users/5276366/egg" title="StackOverflow → https:&#x2F;&#x2F;stackoverflow.com&#x2F;users&#x2F;5276366&#x2F;egg" rel="noopener" target="_blank"><i class="fa fa-fw fa-stack-overflow"></i>StackOverflow</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">zhoul</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v4.2.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">主题 – <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> v7.7.0
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

<script>
  function loadCount() {
    var d = document, s = d.createElement('script');
    s.src = 'https://long12356-gitee-io.disqus.com/count.js';
    s.id = 'dsq-count-scr';
    (d.head || d.body).appendChild(s);
  }
  // defer loading until the whole page loading is completed
  window.addEventListener('load', loadCount, false);
</script>

</body>
</html>
